<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>LIVROS PRO | ACERVO</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar">
    <div class="container nav-content">
      <a href="index.html" class="brand">BIBLIOTECA <span class="highlight">PRO</span></a>
      <ul class="nav-links">
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Cadastrar</a></li>
        <li><a href="listagem.html">Ver Acervo</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <h1 class="page-title">LIVROS <span class="highlight">CADASTRADOS</span></h1>
    <div id="grid" class="cards-grid"></div>
  </main>

  <script>
    async function carregarProdutos() {
      const grid = document.getElementById('grid')
      
      try {
        const res = await fetch('http://localhost:3000/produtos')
        
        if (!res.ok) throw new Error('Falha ao buscar dados')
        
        const dados = await res.json()

        if (dados.length === 0) {
          grid.innerHTML = `<h2 style="grid-column: 1/-1; text-align: center; color: var(--text-muted);">
            Nenhum produto encontrado no estoque remoto.
          </h2>`
          return
        }

        grid.innerHTML = dados.map(p => `
          <article class="book-card">
            <h2>${p.nome || 'Sem nome'}</h2>
            <p class="book-info"><strong>DESCRIÇÃO:</strong> ${p.descricao || 'Não informada'}</p>
            <p class="book-info"><strong>PREÇO:</strong> R$ ${p.preco || 0}</p>
            <p class="book-info"><strong>ESTOQUE:</strong> ${p.estoque || 0}</p>
            <button class="btn-delete" onclick="deletarProduto(${p.id})">Apagar</button>
          </article>
        `).join('')

      } catch (err) {
        console.error('Erro na listagem:', err)
        grid.innerHTML = `<h2 style="grid-column: 1/-1; text-align: center; color: #ff4d4d;">
          ERRO AO CONECTAR: Verifique se o backend está rodando.
        </h2>`
      }
    }

    async function deletarProduto(id) {
      try {
        const res = await fetch(`http://localhost:3000/produtos/${id}`, { method: 'DELETE' })
        if (!res.ok) throw new Error('Falha ao deletar')
        const json = await res.json()
        alert(json.mensagem || 'Produto deletado com sucesso')
        carregarProdutos()
      } catch (err) {
        console.error('Erro ao apagar:', err)
        alert('Não foi possível apagar o produto.')
      }
    }

    carregarProdutos()
  </script>
</body>
</html>